diploiVersion: v1.0
type: component
name: Supabase
description: Official Diploi component for Supabase

defaultContainer: supabase-studio

hosts:
  - name: Supabase
    identifier: app
    urlFormat: '[label].[default-domain]'
    link: https://${DASHBOARD_USERNAME}:${DASHBOARD_PASSWORD}@${HOST}

connectionStrings:
  - name: Internal Address
    value: http://kong.${DIPLOI_NAMESPACE}:8000
  - name: PostgreSQL Connection URI
    value: postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

parameterGroups:
  - name: Dashboard
    identifier: dashboard
    description: Supabase dashboard configuration
    parameters:
      - name: Username
        identifier: DASHBOARD_USERNAME
        defaultValue: supabase
        type: string
      - name: Password
        identifier: DASHBOARD_PASSWORD
        defaultValue: '${generate-random-password:16}'
        type: secret
      - name: Default Organization
        identifier: STUDIO_DEFAULT_ORGANIZATION
        defaultValue: Default Organization
        type: string
      - name: Default Project
        identifier: STUDIO_DEFAULT_PROJECT
        defaultValue: Default Project
        type: string
  - name: Email
    identifier: email
    description: Configure SMTP to send emails
    toggleable: true
    defaultValue: false
    parameters:
      - name: SMTP Admin Email
        identifier: SMTP_ADMIN_EMAIL
        defaultValue: admin@example.com
        type: string
      - name: SMTP Host
        identifier: SMTP_HOST
        defaultValue: supabase-mail
        type: string
      - name: SMTP Port
        identifier: SMTP_PORT
        defaultValue: 2500
        type: integer
      - name: SMTP User
        identifier: SMTP_USER
        defaultValue: fake_mail_user
        type: string
      - name: SMTP Pass
        identifier: SMTP_PASS
        defaultValue: fake_mail_password
        type: string
      - name: SMTP Sender Name
        identifier: SMTP_SENDER_NAME
        defaultValue: fake_sender
        type: string
      - name: Enable Email Sign Up
        identifier: ENABLE_EMAIL_SIGNUP
        defaultValue: false
        type: boolean
      - name: Enable Email Automatic Confirmation
        identifier: ENABLE_EMAIL_AUTOCONFIRM
        defaultValue: false
        type: boolean
  - name: API Keys & Values
    identifier: admin
    description: Secure keys & values for accessing and running your Supabase services
    parameters:
      - name: JWT Secret
        identifier: JWT_SECRET
        defaultValue: '${generate-random-password:32}'
        type: secret
      - name: Anon Key
        identifier: ANON_KEY
        defaultValue: '${generate-jwt:JWT_SECRET:role=anon&iss=supabase&exp=126144000}'
        type: string
      - name: Service Role Key
        description: To generate new JWT values, see https://supabase.com/docs/guides/self-hosting/docker#generate-api-keys
        identifier: SERVICE_ROLE_KEY
        defaultValue: '${generate-jwt:JWT_SECRET:role=service_role&iss=supabase&exp=126144000}'
        type: secret
      - name: Vault Encryption Key
        identifier: VAULT_ENC_KEY
        defaultValue: '${generate-random-password:32}'
        type: secret
      - name: Pooler Tenant ID
        identifier: POOLER_TENANT_ID
        defaultValue: '${generate-random-password:8}'
        type: secret
      - name: Logflare Public Access Token
        identifier: LOGFLARE_PUBLIC_ACCESS_TOKEN
        defaultValue: '${generate-random-password:64}'
        type: string
      - name: Logflare Private Access Token
        identifier: LOGFLARE_PRIVATE_ACCESS_TOKEN
        defaultValue: '${generate-random-password:64}'
        type: secret
      - name: Phoenix Secret
        identifier: SECRET_KEY_BASE
        defaultValue: '${generate-random-password:48}'
        type: secret
  - name: PostgreSQL
    identifier: postgres
    description: Superuser & connection configuration
    parameters:
      - name: Host
        identifier: POSTGRES_HOST
        defaultValue: db.${DIPLOI_NAMESPACE}
        type: string
        readOnly: true
      - name: Port
        identifier: POSTGRES_PORT
        defaultValue: 5432
        type: integer
      - name: User
        identifier: POSTGRES_USER
        defaultValue: postgres
        type: string
        contexts: label=postgres,label=app
      - name: Password
        identifier: POSTGRES_PASSWORD
        defaultValue: '${generate-random-password:32}'
        type: secret
      - name: Database
        identifier: POSTGRES_DB
        defaultValue: supabase
        type: string
  - name: OpenAI
    identifier: openai
    description: Add your OpenAI API key to enable SQL Editor Assistant
    toggleable: true
    defaultValue: false
    parameters:
      - name: OpenAI API Key
        identifier: OPENAI_API_KEY
        defaultValue: ''
        type: secret
  - name: Google Cloud Project
    identifier: google
    description: Support Sign in with Google by connecting to a Google Cloud Platform project
    toggleable: true
    defaultValue: false
    parameters:
      - name: Google Cloud Project ID
        identifier: GOOGLE_PROJECT_ID
        defaultValue: ''
        type: string
      - name: Google Cloud Project Number
        identifier: GOOGLE_PROJECT_NUMBER
        defaultValue: ''
        type: string
  - name: Internal Addresses
    identifier: internal
    description: Internal endpoints for different Supabase services
    parameters:
      - name: Auth
        identifier: AUTH_INTERNAL_URL
        defaultValue: http://auth.${DIPLOI_NAMESPACE}:9999
        type: string
        readOnly: true
      - name: REST
        identifier: REST_INTERNAL_URL
        defaultValue: http://rest.${DIPLOI_NAMESPACE}:3000
        type: string
        readOnly: true
      - name: Realtime
        identifier: REALTIME_INTERNAL_URL
        defaultValue: ws://realtime.${DIPLOI_NAMESPACE}:4000
        type: string
        readOnly: true
      - name: Storage
        identifier: STORAGE_INTERNAL_URL
        defaultValue: http://storage.${DIPLOI_NAMESPACE}:5000
        type: string
        readOnly: true
      - name: Functions
        identifier: FUNCTIONS_INTERNAL_URL
        defaultValue: http://functions.${DIPLOI_NAMESPACE}:9000
        type: string
        readOnly: true
      - name: Analytics
        identifier: ANALYTICS_INTERNAL_URL
        defaultValue: http://analytics.${DIPLOI_NAMESPACE}:4000
        type: string
        readOnly: true
      - name: Meta
        identifier: META_INTERNAL_URL
        defaultValue: http://meta.${DIPLOI_NAMESPACE}:8080
        type: string
        readOnly: true
      - name: Studio
        identifier: STUDIO_INTERNAL_URL
        defaultValue: http://studio.${DIPLOI_NAMESPACE}:3000
        type: string
        readOnly: true
      - name: Kong
        identifier: KONG_INTERNAL_URL
        defaultValue: http://kong.${DIPLOI_NAMESPACE}:8000
        type: string
        readOnly: true

environmentVariables:
  - identifier: SITE_URL
    defaultValue: ''
  - identifier: DISABLE_SIGNUP
    defaultValue: false
  - identifier: ENABLE_ANONYMOUS_USERS
    defaultValue: false
  - identifier: ENABLE_PHONE_SIGNUP
    defaultValue: true
  - identifier: ENABLE_PHONE_AUTOCONFIRM
    defaultValue: true
  - identifier: FUNCTIONS_VERIFY_JWT
    defaultValue: false
  - identifier: JWT_EXPIRY
    defaultValue: 3600
  - identifier: PGRST_DB_SCHEMAS
    defaultValue: public,storage,graphql_public
  - identifier: ADDITIONAL_REDIRECT_URLS
    defaultValue: ''

images:
  - identifier: functions
    prebuildImage: ghcr.io/diploi/component-supabase:[tag]

storage:
  - identifier: supabase
    sizeMiB: 8192
  - identifier: postgres
    sizeMiB: 8192
  - identifier: pgsodium
    sizeMiB: 512
